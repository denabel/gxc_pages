<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>GESIS meets Copernicus (GxC) - Introduction to Earth observation data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">GESIS meets Copernicus (GxC)</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tutorials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutorials">    
        <li>
    <a class="dropdown-item" href="./eod_intro.html">
 <span class="dropdown-text">Intro to EOD</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./raster_data.html">
 <span class="dropdown-text">Raster data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./issp.html">
 <span class="dropdown-text">Case study ISSP</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./package.html"> 
<span class="menu-text">Package</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./courses.html"> 
<span class="menu-text">Courses</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./articles.html"> 
<span class="menu-text">Articles</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-is-earth-observation-data" id="toc-what-is-earth-observation-data" class="nav-link active" data-scroll-target="#what-is-earth-observation-data">What is Earth observation data?</a></li>
  <li><a href="#applications-in-the-social-sciences" id="toc-applications-in-the-social-sciences" class="nav-link" data-scroll-target="#applications-in-the-social-sciences">Applications in the social sciences</a></li>
  <li><a href="#relevant-sources-of-earth-observation-data" id="toc-relevant-sources-of-earth-observation-data" class="nav-link" data-scroll-target="#relevant-sources-of-earth-observation-data">Relevant sources of Earth observation data</a></li>
  <li><a href="#data-quality" id="toc-data-quality" class="nav-link" data-scroll-target="#data-quality">Data quality</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction to Earth observation data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="what-is-earth-observation-data" class="level2">
<h2 class="anchored" data-anchor-id="what-is-earth-observation-data">What is Earth observation data?</h2>
<p>Earth observation (EO) data refers to all collected information about the Earth’s physical, chemical, and biological systems. Utilizing Earth observation data allows to study the Earth’s atmosphere, land cover, oceans and inland waters, as well as biological diversity and ecosystems. Applications of EO data in academia, industry, and policy-making are extensive. It is crucial for the operation of activities in environmental protection, energy management, urban planning, agriculture and fisheries, forestry, public health, transport and mobility, civil protection, or tourism.</p>
<details>
<summary>
Additional information on Earth system indicators
</summary>
<p>There are many crucial Earth system indicators. With respect to the Earth’s climate, for example, the Global Climate Observing System (GCOS) maps 55 Essential Climate Variables (ECVs). ECVs are seen as the empirical evidence base for the guidance of mitigation and adaptation measures, risk assessment and the understanding of climate services. EO data is essential for systematically measuring these variables. Check out their <a href="https://gcos.wmo.int/en/essential-climate-variables/about">documentation of ECVs</a>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/ecvs.png" class="img-fluid figure-img" style="width:60.0%" data-align="center"></p>
<figcaption>ECVs as proposed by GCOS. Source: GCOS 2024 (https://gcos.wmo.int/en/essential-climate-variables/)</figcaption>
</figure>
</div>
</details>
<p>There is often confusion about terms such as Earth observation data, geodata, remote sensing, or satellite data. Let’s disentangle these different concepts.</p>
<ul>
<li><strong>Earth observation data</strong>: Information collected about the Earth’s system</li>
<li><strong>Geospatial data</strong>: Data that is georeferenced (includes information on the location)</li>
<li><strong>Remote sensing data</strong>: Information that is acquired by sensors “from a distance”</li>
<li><strong>Satellite data</strong>: Information that is acquired by sensors via satellites.</li>
</ul>
<p>As you can see, these four terminologies address different aspects of the data. While “EO data” refers to the content of the data (the Earth system), “geospatial data” addresses the location, and “remote sensing” and “satellite data” address the way of obtaining the data.</p>
<p>The Venn diagram below visualizes these definitions and shows overlaps and gaps between these concepts. Except for satellite data, which can be seen as a subset of remote sensing data, all other concepts have overlaps and gaps with each other.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/EO_venn.png" class="img-fluid figure-img" style="width:60.0%" data-align="center"></p>
<figcaption>EO Venn diagram. Source: Abel and Jünger 2024</figcaption>
</figure>
</div>
<p>Let’s disentangle these overlaps a bit further:</p>
<ul>
<li><strong>A</strong>: The area <strong>A</strong> captures all concepts discussed above - Georeferenced Earth observation data derived from satellite data (and thus remote sensing). An example for this are nighttime lights. The sentinel satellite… [insert example and link].</li>
<li><strong>B</strong>: Area <strong>B</strong> is similar to <strong>A</strong> except that this data is derived from remote sensing OTHER than satellite data. There are, in fact, other sources of sensors from aircrafts or drones. Data on gases in the atmosphere are collected that way - an example would be… [insert]</li>
<li><strong>C</strong>: <strong>C</strong> represents EO data which is georeferenced but NOT derived from remote sensing. There are several alternatives to EO data generation: When it comes to sensor-based data collection, ground-based sensors (called “in-situ”) which collect data locally are common sources of EO data. Weather stations are common examples. But <strong>C</strong> also captures a data source which is very familiar to social scientists: Field surveys and survey-based methods. This work is not just performed by experts. Think about citizen science projects: Scientists work together with “laypeople” to map bird populations [link], the quality of rivers [link], or XXX.</li>
<li><strong>D</strong> and <strong>E</strong>: The two areas <strong>D</strong> and <strong>E</strong> deviate from the previous areas because they are NOT EO data. <strong>D</strong> captures all geodata which is not derived from remote sensing and does not constitute EO data. This is primarily data which is human-centered - many examples of which are familiar to social scientists: Georeferenced variables on socio-demographics or economic indicators like Census data [link], electoral outcomes [link], or environmental attitudes and behavior [link]. <strong>E</strong> represents a special case of such data derived from remote sensing. Examples could be XY.</li>
</ul>
<p>As you can see, the main areas when it comes to EO data are <strong>A</strong>, <strong>B</strong>, and <strong>C</strong>. As social scientists interested in working with EO data, <strong>D</strong> and <strong>E</strong> are similarly relevant: Often, we are interested in spatially linking our social indicators (<strong>D</strong>) with EO data. We therefore see these as two sides of the same coin. The geolocation represents the link.</p>
<p>Be aware that there are a few additional areas in the Venn diagram which we have not highlighted. These are the fields which do not overlap with the circle for “geodata”. There are some examples for non-georeferenced EO data or remote sensing data like X, Y, Z. Since we are focussing on geo-referenced data in this project, these part will not be further considered in our tutorials.</p>
<p>It should be noted that in practice, common indicators are integrated from various sensors or data collection types to increase data quality by enhancing accuracy, scope and resolution, to validate data, or to fill data gaps. We will explore a few common sources and indicators in the next chapter.</p>
</section>
<section id="applications-in-the-social-sciences" class="level2">
<h2 class="anchored" data-anchor-id="applications-in-the-social-sciences">Applications in the social sciences</h2>
<p>A growing interest in economics and the social sciences in earth observation data has led to a broad thematic spectrum of publications in recent years. They range from studying environmental attitudes and behavior, economic development, the role of climate change for violent conflicts and causes of flight, and electoral behavior.</p>
<p>Articles include <span class="citation" data-cites="hoffmann_climate_2022 garcia-leon_current_2021 jean_combining_2016">(<a href="#ref-garcia-leon_current_2021" role="doc-biblioref">García-León et al., 2021</a>; <a href="#ref-hoffmann_climate_2022" role="doc-biblioref">Hoffmann et al., 2022</a>; <a href="#ref-jean_combining_2016" role="doc-biblioref">Jean et al., 2016</a>)</span>.</p>
<p>Novel applications of machine learning (ML) on satellite and aerial imagery expand the potential of EO data for the construction of new indicators. Stanford’s <a href="https://deepsolar.web.app/">DeepSolar</a>, for example, maps solar PV installations.</p>
</section>
<section id="relevant-sources-of-earth-observation-data" class="level2">
<h2 class="anchored" data-anchor-id="relevant-sources-of-earth-observation-data">Relevant sources of Earth observation data</h2>
<p>Europe’s Earth Observation programme is called <a href="https://www.copernicus.eu/en">Copernicus</a>. It is funded and managed by the European Commission and partners like the <a href="https://www.esa.int/">European Space Agency</a> (ESA) and the <a href="https://www.eumetsat.int/">European Organisation for the Exploitation of Meteorological Satellites</a> (EUMETSAT). It has been operational since 2014 and provides free access to a wealth of satellite data from ESA’s “Sentinel” fleet. Copernicus combines data from satellites, ground-based as well as air- and sea-borne sensors to track the Earth system and provide this information largely free for all customers.</p>
<details>
<summary>
Additional information on the Copernicus programme
</summary>
Check out this 5min <a href="https://www.youtube.com/watch?v=MGJss4lDaBo">video</a> on the Copernicus programme.
</details>
<p>The ESA describes Copernicus as the world’s most ambitious Earth observation program, which will be further expanded in the coming years. On the <a href="https://www.copernicus.eu/en/access-data.">Copernicus homepage</a>, the daily data collection is estimated at 12 terabytes. Given the complexity of issues, Copernicus has separated its services for public usage along several thematic areas:</p>
<ul>
<li><strong>Atmosphere</strong>: <a href="https://atmosphere.copernicus.eu/">Copernicus Atmosphere Monitoring Service</a> (CAMS)</li>
<li><strong>Marine</strong>: <a href="https://marine.copernicus.eu/">Copernicus Marine Service</a> (CMEMS)</li>
<li><strong>Land</strong>: <a href="https://land.copernicus.eu/en">Copernicus Land Monitoring Service</a> (CLMS)</li>
<li><strong>Climate change</strong>: <a href="https://climate.copernicus.eu/">Copernicus Climate Change Service</a> (C3S)</li>
<li><strong>Emergency</strong>: <a href="https://emergency.copernicus.eu/">Copernicus Emergency Management Service</a> (CEMS).</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/copernicus_services.png" class="img-fluid figure-img" style="width:60.0%" data-align="center"></p>
<figcaption>Copernicus infrastructure and data services. Source: https://www.copernicus.eu/en/accessing-data-where-and-how/conventional-data-access-hubs</figcaption>
</figure>
</div>
<p>This project focuses on the data provided by the Copernicus programme. However, this is not the only relevant source of EO data which you can consider for your projects. The US equivalent, for example, is based on the <a href="https://landsat.gsfc.nasa.gov/">Landsat satellite programme</a>, which is jointly operated by <a href="https://www.nasa.gov/">NASA</a> and the <a href="https://www.usgs.gov/landsat-missions">US Geological Survey</a> (USGS). <a href="https://developers.google.com/earth-engine/datasets/catalog">Google’s Earth Engine Cloud Computing Platform</a> catalogs an extensive selection of additional data sets from various sources.</p>
</section>
<section id="data-quality" class="level2">
<h2 class="anchored" data-anchor-id="data-quality">Data quality</h2>
<p>Data quality</p>
<p>The German Federal Statistical Office (DESTATIS) is currently evaluating the usage of remote sensing data for official statistical accounts in several projects as part of their <a href="https://www.destatis.de/EN/Service/EXSTAT/_node.html">experimental statistics</a>.</p>
<ul>
<li><a href="https://www.destatis.de/EN/Service/EXSTAT/Datensaetze/satellite-data.html">Smart business cycle statistics based on satellite data</a></li>
<li><a href="https://www.destatis.de/EN/Service/EXSTAT/Datensaetze/register-census.html">Remote sensing data and artifical intelligence in the register census</a></li>
<li><a href="https://www.destatis.de/EN/Service/EXSTAT/Datensaetze/satellite-based-early-estimate.html">Satellite-based early estimate of short-term economic development</a></li>
</ul>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-garcia-leon_current_2021" class="csl-entry" role="listitem">
García-León, D., Casanueva, A., Standardi, G., Burgstall, A., Flouris, A. D., &amp; Nybo, L. (2021). Current and projected regional economic impacts of heatwaves in <span>Europe</span>. <em>Nature Communications</em>, <em>12</em>(1), 5807. <a href="https://doi.org/10.1038/s41467-021-26050-z">https://doi.org/10.1038/s41467-021-26050-z</a>
</div>
<div id="ref-hoffmann_climate_2022" class="csl-entry" role="listitem">
Hoffmann, R., Muttarak, R., Peisker, J., &amp; Stanig, P. (2022). Climate change experiences raise environmental concerns and promote <span>Green</span> voting. <em>Nature Climate Change</em>, <em>12</em>(2), 148–155. <a href="https://doi.org/10.1038/s41558-021-01263-8">https://doi.org/10.1038/s41558-021-01263-8</a>
</div>
<div id="ref-jean_combining_2016" class="csl-entry" role="listitem">
Jean, N., Burke, M., Xie, M., Davis, W. M., Lobell, D. B., &amp; Ermon, S. (2016). Combining satellite imagery and machine learning to predict poverty. <em>Science</em>, <em>353</em>(6301), 790–794. <a href="https://doi.org/10.1126/science.aaf7894">https://doi.org/10.1126/science.aaf7894</a>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>